server {
    listen 80;
    server_name localhost;

    # Для клиентов (Element, телефоны)
    location /.well-known/matrix/client {
        alias /usr/share/nginx/html/client.json;
        default_type application/json;

        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, OPTIONS";
        add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";

        try_files $uri =404;
    }

    # Для Федерации и Сервисов (LiveKit, другие серверы)
    location /.well-known/matrix/server {
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        # Ответ: "Иди на matrix.ziix.ru порт 443"
        return 200 '{"m.server": "{{ tuwunel_domain }}:443"}';
    }
}
