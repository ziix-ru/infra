---
restic:
  service: "restic"

  # Image Build Info
  image: "local/restic-with-rclone:latest"
  base_image: "restic/restic:0.17.0"

  # Paths
  path: "{{ docker.base_dir }}/restic"
  build_dir: "{{ docker.base_dir }}/restic/build"

  # Repository
  repo: "rclone:gdrive:vps_backups"

  # --- BACKUP CONFIGURATION ---
  backup:
    mounts:
      - src: "{{ docker.base_dir }}"
        dst: "/data"
    # Service to stop before backup (e.g. 'tuwunel' for DB consistency)
    stop_service: ""

    # Retention Policy
    keep:
      daily: 7
      weekly: 4

    # Healthcheck URL (e.g. Healthchecks.io)
    healthcheck_url: ""

  # --- SCHEDULE (Systemd Timers) ---
  schedule:
    backup: "*-*-* 04:00:00"      # Daily at 4 AM
    check: "Sun *-*-* 06:00:00"   # Sunday at 6 AM

  # --- INTEGRITY CHECK ---
  check:
    subset: "5%" # Check 5% of data weekly

  # --- RCLONE TUNING ---
  rclone:
    chunk_size: "128M"
    timeout: "10m"
    # Config content from Vault
    config: "{{ vault_backup.rclone_config }}"

  # --- SECRETS ---
  password: "{{ vault_backup.restic_password }}"

  # --- RESOURCES ---
  memory: "512M"
